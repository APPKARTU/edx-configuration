#!/usr/bin/env bash

# {{ ansible_managed }}

{% set course_discovery_venv_bin = course_discovery_home + "/venvs/" + course_discovery_service_name + "/bin" %}
{% set executable = course_discovery_venv_bin + '/gunicorn' %}
{% set ansible_playbook = "/edx/app/edx_ansible/venvs/edx_ansible/bin/ansible-playbook" %}

cd /edx/app/edx_ansible/edx_ansible/docker/plays
sudo {{ ansible_playbook }} course_discovery.yml -c local -t 'migrate:devstack' --extra-vars="migrate_db=yes"

{{ executable }} -c {{ course_discovery_home }}/course_discovery_gunicorn.py {{ COURSE_DISCOVERY_GUNICORN_EXTRA }} edx_course_discovery.wsgi:application
